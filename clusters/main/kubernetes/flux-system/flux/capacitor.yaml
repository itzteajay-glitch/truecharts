apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: capacitor
  namespace: flux-system
spec:
  interval: 1h
  chart:
    spec:
      chart: ghcr.io/gimlet-io/capacitor-manifests
      sourceRef:
        kind: OCIRepository
        name: capacitor
      version: ">=0.1.0"
    values:
      service:
        main:
          type: LoadBalancer
          loadBalancerIP: ${CAPACITOR_IP}
      ingress:
        main:
          enabled: true
          hosts: 
            - host: capacitor.${DOMAIN_0}
              paths:
                - path: /
                  pathType: Prefix
          integrations:
            certManager:
              enabled: true
              certificateIssuer: "domain-0-le-prod"
            traefik:
              enabled: true
              entrypoints:
                - websecure